{% extends "inspectors/employee/index.html" %}
{% load static %}
<!--اسم المستخدم-->
{% block username %}
{{username}}
 {% endblock %}
 {% block username2 %}
 {{username}}
  {% endblock %}

<!--ًصورة المستخدم-->
  {% block profileImg %}
  <img alt="avatar" src="../../../{{img}}" class="rounded-circle">
  {% endblock %}
  {% block profileImg2 %}
  <img alt="avatar" src="../../../{{img}}" class="rounded-circle">
  {% endblock %}

{% block clients_home %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css">

<div class="row"></div>
<div class="col-12 mb-2">
    <a href="{% url 'evaluate' orID %}" class="btn btn-sm btn-dark"> <  الرجوع لأماكن التقتيش  </a>
</div>

<table class="table table-striped">
    <thead>
        <tr class="bg-dark">
            <th colspan="3" class="text-center">{{ zoneName }}</th>
        </tr>
        <tr>
            <th>البند</th>
            <th>تقييم</th>
            <th>النتيجة</th>
        </tr>
    </thead>
    <tbody>
        {% for r in row %}
        <tr>
            <td>{{ r.term }} <br>
                {% if r.termNote%}
                <a id="showNote" href="#" class="text-danger" data-toggle="modal" data-target="#note_show{{ r.term_id }}" >شروط خاصة</a>
               {% endif %}
            </td>
            <td>
                {% if r.status %}
                {% else %}
                <a href="#" class="btn btn-sm btn-dark" data-toggle="modal" data-target="#evaluationModal{{ r.term_id }}" onclick="openEvaluationModal()">قيم</a>
                {% endif %}
            </td>
            <td>
                {% if r.score %}
                    {% if r.score == ' ' %}
                         مستبعد
                    {% elif r.score == '1' %}
                    <i class="bi bi-check-circle-fill text-success" style="font-size: 1rem;"></i>
                    {% elif r.score == '0' %}
                    <i class="bi bi-x-circle-fill text-danger" style="font-size: 1rem;"></i>
                    {% endif %}
                {% else %}
                    لم يتم التقييم
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Evaluation Modal -->
{% for r in row %}
<div class="modal fade" id="evaluationModal{{ r.term_id }}" tabindex="-1" aria-labelledby="evaluationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ r.term }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="evaluationForm{{ r.term_id }}" method="post" action="#" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="text" value="{{r.term_id}}" name="termid" hidden />
                    <div class="mb-3">
                        <label for="evaluationSelect{{ r.term_id }}" class="form-label">التقييم</label>
                        <select class="form-select evaluation-select" name="evaluation" id="evaluationSelect{{ r.term_id }}" required onchange="toggleImageAndCommentSections({{ r.term_id }})">
                            <option value="">اختر...</option>
                            <option value="1">نعم</option>
                            <option value="0">لا</option>
                            <option value=" ">تخطي</option>
                        </select>
                    </div>
                    <div id="imageUploadSection{{ r.term_id }}" class="mb-3" style="display: none;">
                        <label for="imageUpload" class="form-label">رفع صورة</label>
                        <input class="form-control" type="file" name="img0" id="imageUpload{{ r.term_id }}" accept="image/*" capture="camera">
                    </div>
                    <div id="commentSection{{ r.term_id }}" class="mb-3" style="display: none;">
                        <label for="comment" class="form-label">ملاحظات</label>
                        <textarea class="form-control" name="note" id="comment{{ r.term_id }}" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">اغلاق</button>
                    <button type="submit" class="btn btn-primary">حفظ</button>
                </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}


     <!-- Modal -->
     {% for r in row %}
     <div class="modal fade" id="note_show{{r.term_id}}" tabindex="-2" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">             
            </div>
            <div class="modal-body">
             
                <h3>{{r.termNote}}</h3>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">اغلاق</button>
           
            </div>
          </div>
        </div>
      </div>
    </div>
      {% endfor %}

<script>
    function toggleImageAndCommentSections(termId) {
        const selectElement = document.getElementById('evaluationSelect' + termId);
        const imageSection = document.getElementById('imageUploadSection' + termId);
        const commentSection = document.getElementById('commentSection' + termId);

        if (selectElement.value === "0") {  // إذا تم اختيار "لا"
            imageSection.style.display = "block";
            commentSection.style.display = "block";
        } else {
            imageSection.style.display = "none";
            commentSection.style.display = "none";
        }
    }

    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function(event) {
            const evaluationSelect = form.querySelector('.evaluation-select');
            if (!evaluationSelect.value) {
                event.preventDefault();  // منع الإرسال إذا لم يتم اختيار تقييم
                alert("يجب اختيار تقييم قبل الإرسال.");
            }
        });
    });
</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

{% endblock %}